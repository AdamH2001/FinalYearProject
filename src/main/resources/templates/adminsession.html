<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" type="text/javascript"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.8/umd/popper.min.js" type="text/javascript"> </script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" type="text/javascript"></script>
	<link rel="stylesheet" href="./css/styles.css"/>
<script src="./scripts/afterschoolclub.js" type="text/javascript"></script>	
</head>

<body onLoad="setDateLimits()">
	<div th:replace="~{fragments/header :: header}"></div>
	<div th:replace="~{fragments/leftnav :: leftnav}"></div>
	<div th:replace="~{fragments/footer :: footer}"></div>

	
	<div id="main" class="main container-flex no-margin ">

		<div class="row flex-nowrap">

			<form th:action="${takingRegister} ? './addRegister' : './addEvent'" method="post" onSubmit="validateEventForm(event)">
			
				<input id="eventId" type="hidden" name="eventId" th:value="${clubSession.getEventId()}" />
				<input th:if="${viewing}" id="viewing" type="hidden" name="viewing" th:value="viewing" />
				
				
					<div class="row mb-2">
						<div class="col-sm-12" align="center">
							<h1 th:if="${editing}" align="center">Edit Club Session</h1>
							<h1 th:if="${viewing} and ${not takingRegister}" align="center">View Club Session</h1>
							<h1 th:if="${viewing} and ${takingRegister}" align="center">Take Register for <span th:text="${clubSession.getClub().getTitle()}"></span></h1>
							<h1 th:if="${scheduling}" align="center">Schedule Club Session</h1>
						</div>
					</div>
					<th:block th:if="${resourceStatus}">
						<th:block  th:each="status : ${resourceStatus}" >
							<div th:unless="${status.isSufficient()}" class="afterschoolclubflash row mb-2">
								<div class="col-sm-12" th:text="${status.getMessage()}">FlashMessage</div>
							</div>						
						</th:block>
					</th:block>
					
					<div class="afterschoolclubflash row mb-2"  style="display: none" id="validationContainer">					
						<div class="col-sm-12"  id="validationMessage"></div>
					</div>	

					<div class="row mb-2">
						<div class="col-sm-1" align="right">
							<label for="club">Club:</label>
						</div>
						<div class="col-sm-4">
							<select class="form-select form-control-sm mr-sm-2"  name="club" id="club" required th:disabled="${clubSession.getNumberAttendees()&gt;0} or ${viewing}">
								<option th:each="club : ${clubs}" th:value="${club.getClubId()}" th:text="${club.getTitle()}" th:selected="${clubSession.getClub()?.getClubId() == club.getClubId()}">Club Title</option>
							</select>
							<input th:if="${clubSession.getNumberAttendees()&gt;0} or ${viewing}" type=hidden name="club" th:value="${clubSession.getClub()?.getClubId()}" />
						</div>
					</div>

					<div class="row mb-2">
						<div class="col-sm-1" align="right">
							<label for="club">Location:</label>
						</div>
						<div class="col-sm-4">
							<select class="form-select form-control-sm mr-sm-2" name="location" id="location" required th:disabled="${viewing}">
								<option th:each="location : ${locations}" 
										th:value="${location.getResourceId()}" 
										th:text="${location.getName()}" 
										th:selected="${clubSession.getLocation()?.getResourceId() == location.getResourceId()}">location Name</option>
							</select>
						</div>
						<div class="col-sm-2" align="right">
							<label for="maxAttendees">Max Attendees:</label>
						</div>
						<div class="col-sm-4">
							<input class="form-control form-control-sm mr-sm-2" required type="number" name="maxAttendees" id="maxAttendees" min="1" th:disabled="${viewing}" th:value="${clubSession.getMaxAttendees()}" />
						</div>
						
					</div>
					
					<div class="row mb-2">
						<div class="col-sm-1" align="right" >
							<label for="staff">Staff:</label>
						</div>
						<div class="col-sm-10">
							<select class="form-select form-control-sm mr-sm-2" name="staff" id="staff" required multiple th:disabled="${viewing}">
								<option th:if="${viewing} and ${clubSession.requiresStaff(staffMember)}" th:each="staffMember : ${staff}" th:value="${staffMember.getResourceId()}" th:text="${staffMember.getName()}" th:selected="${clubSession.requiresStaff(staffMember)}">Staff Name</option>
								<option th:if="${editing} or ${scheduling}" th:each="staffMember : ${staff}" th:value="${staffMember.getResourceId()}" th:text="${staffMember.getName()}" th:selected="${clubSession.requiresStaff(staffMember)}">Staff Name</option>								
							</select>
						</div>
					</div>
										
					
					<div class="row mb-2">
						<div class="col-sm-1" align="right">
							<label for="startDate">Time:</label>
						</div>
						<div class="col-sm-10">			
							<fieldset class="form-group border p-3">			
								<div class="container-fluid no-margin">
									<div class="row mb-2">		
								
										<div class="col-sm-2" align="right">
											<label for="startTime">Start:</label>
																	
										</div>				
										<div class="col-sm-3">						
											<input class="form-control form-control-sm mr-sm-1" min="06:00" required type="time" name="startTime" id="startTime"  th:value="${clubSession.getStartTime()}" onChange="setDateLimits()" th:disabled="${viewing}"/>
										</div>
										
																
										<div class="col-sm-4" align="right">
											<label for="startDate">Date:</label>
										</div>
										
										<div class="col-sm-3" align="left">							
											<input class="form-control form-control-sm mr-sm-1" min="" required type="date" name="startDate" id="startDate" th:value="${clubSession.getStartDate()}" onChange="setDateLimits()" th:disabled="${viewing}"/>
										</div>
																				
									</div>
									<div class="row mb-2">
										<div class="col-sm-2" align="right">
											<label for="endTime">End:</label>
										</div>
										<div class="col-sm-3">											
											<input class="form-control form-control-sm mr-sm-2" required type="time" name="endTime" id="endTime" th:value="${clubSession.getEndTime()}" onChange="setDateLimits()" th:disabled="${viewing}"/>
										</div>
															
										<div th:if="${scheduling} or ${viewing AND clubSession.isRecurring()}"  class="col-sm-4" align="right">							
											
											<label for="recurringEndDate">Repeat Until:</label>
										</div>
										
										<div th:if="${scheduling} or ${viewing AND clubSession.isRecurring()}" class="col-sm-3">
											<input class="form-control form-control-sm mr-sm-2" min="" required type="date" name="recurringEndDate" id="recurringEndDate" th:value="${clubSession.getRecurrenceSpecification().getFormattedEndDate()}" onChange="setDateLimits()" th:disabled="${viewing}"/>
										</div>
										
										
									</div>
									
									<div class="row mb-2"></div>
									<div th:unless="${editing}"  class="row mb-2">
										<div class="col-sm-2" align="right">
											<label for="recurringEndDate" class="recurSpecifier">Recurring Pattern:</label>
										</div>
										<div class="col-sm-10">
											<fieldset class="form-group border p-3 recurSpecifier">
												<div class="container-fluid no-margin">
													<div class="row mb-2">
										
														<div class="col-sm-1" align="right">
															<label for="MonRecurring">Mon:</label>
														</div>
														<div class="col-sm-1" align="left">							
															<input class="form-check-input recurSpecifier" type="checkbox"  th:checked="${clubSession.getRecurrenceSpecification().isOccursMonday()}" name="MonRecurring" id="MonRecurring" th:disabled="${viewing}"/>
														</div>
														<div class="col-sm-1" align="right">
															<label for="TueRecurring">Tue:</label>
														</div>
														<div class="col-sm-1" align="left">								
															<input class="form-check-input recurSpecifier" type="checkbox"  th:checked="${clubSession.getRecurrenceSpecification().isOccursTuesday()}" name="TueRecurring" id="TueRecurring" th:disabled="${viewing}"/>
														</div>
														<div class="col-sm-1" align="right">
															<label for="WedRecurring">Wed:</label>
														</div>
														<div class="col-sm-1" align="left">								
															<input class="form-check-input recurSpecifier" type="checkbox"  th:checked="${clubSession.getRecurrenceSpecification().isOccursWednesday()}"  name="WedRecurring" id="WedRecurring" th:disabled="${viewing}"/>
														</div>
														<div class="col-sm-1" align="right">
															<label for="ThurRecurring">Thur:</label>
														</div>
														<div class="col-sm-1" align="left">								
															<input class="form-check-input recurSpecifier" type="checkbox"   th:checked="${clubSession.getRecurrenceSpecification().isOccursThursday()}"  name="ThurRecurring" id="ThurRecurring" th:disabled="${viewing}"/>
														</div>
														<div class="col-sm-1" align="right">
															<label for="FriRecurring">Fri:</label>
														</div>
														<div class="col-sm-1" align="left">										
															<input class="form-check-input recurSpecifier" type="checkbox"  th:checked="${clubSession.getRecurrenceSpecification().isOccursFriday()}" name="FriRecurring" id="FriRecurring" th:disabled="${viewing}"/>
														</div>
													</div>
													<div class="row mb-2">													

														<div class="col-sm-1" align="right">
															<label for="SatRecurring">Sat:</label>
														</div>
														<div class="col-sm-1" align="left">								
															<input class="form-check-input recurSpecifier" type="checkbox"  th:checked="${clubSession.getRecurrenceSpecification().isOccursSaturday()}" name="SatRecurring" id="SatRecurring" th:disabled="${viewing}"/>
														</div>
														<div class="col-sm-1" align="right">
															<label for="SunRecurring">Sun:</label>
														</div>
														<div class="col-sm-1" align="left">								
															<input class="form-check-input recurSpecifier" type="checkbox"  th:checked="${clubSession.getRecurrenceSpecification().isOccursSunday()}" name="SunRecurring" id="SunRecurring" th:disabled="${viewing}"/>
														</div>												
													</div>													
												</div>									
											</fieldset>
										</div>
									</div>

									<div th:unless="${editing}" class="row mb-2">
										<div class="col-sm-2" align="right">						
											<label for="termTimeOnly" class="recurSpecifier">Term Time Only:</label>
										</div>
										<div class="col-sm-1" align="left">
											<input class="form-check-input recurSpecifier" type="checkbox"  th:checked="${clubSession.getRecurrenceSpecification().isTermTimeOnly()}" name="termTimeOnly" id="NonHolidaysOnly" th:disabled="${viewing}"/>
										</div>
									</div>										
								</div>								
							</fieldset>							
						</div>																							
					</div>									
										
					<div class="row mb-2" th:if="${clubSession.getMenuGroups().size()>0} or ${editing} or ${scheduling}">
						<div class="col-sm-1" align="right" >
							<label for="staff">Refreshments:</label>
						</div>
						<div class="col-sm-10">
							<select class="form-select form-control-sm mr-sm-2" name="menu" id="menu" multiple th:disabled="${viewing}">
								<option th:if="${viewing} and ${clubSession.includesMenuGroup(menu.getMenuGroupId())}" th:each="menu : ${menus}" th:value="${menu.getMenuGroupId()}" th:text="${menu.getName()}" th:selected="${clubSession.includesMenuGroup(menu.getMenuGroupId())}">Menu Name</option>
								<option th:if="${editing} or ${scheduling}"  th:each="menu : ${menus}" th:value="${menu.getMenuGroupId()}" th:text="${menu.getName()}" th:selected="${clubSession.includesMenuGroup(menu.getMenuGroupId())}">Menu Name</option>																														
							</select>
						</div>
					</div>

					<div th:if="${editing} or ${scheduling} or ${viewing AND clubSession.getEquipmentEventResources().size()>0}" class="row mb-2">
						<div class="col-sm-1" align="right">
							<label>Equipment:</label>
						</div>
	
						<div class="col-sm-10">
							<fieldset class="form-group border p-3">
								<div class="container-fluid no-margin">
									<div class="row mb-2">
	
										<div class="col-sm-1" align="center"></div>
	
										<div class="col-sm-3" align="center">
											<label>Item</label>
										</div>
	
										<div class="col-sm-2" align="center">
											<label>Quantity</label>
										</div>
										<div class="col-sm-2" align="center">
											<label>Per Attendee</label>
										</div>
									</div>
									<div
										th:each="sessionResource, iter: ${clubSession.getEquipmentEventResources()}"
										class="row mb-2" th:id="${'item'+(iter.index+1)}">
										<div class="col-sm-1" align="right">
											<label th:text="${'Item '+(iter.index+1)+ ':'}">Item 1:</label>
										</div>
										<div class="col-sm-3">
											<select class="form-select form-control-sm mr-sm-2"
												name="equipment" th:id="${'equipment'+(iter.index+1)}" th:disabled="${viewing}">
												<option value="0">None</option>
												<option th:each="item : ${equipment}"
													th:value="${item.getResourceId()}"
													th:text="${item.getName()}"
													th:selected="${sessionResource.getResourceId().getId().intValue()==item.getResourceId()}">Equipment
													Name</option>
											</select>
										</div>
	
										<div class="col-sm-2">
											<input class="form-control form-control-sm mr-sm-2"
												th:id="${'equipmentQuantity'+(iter.index+1)}" type="number"
												name="equipmentQuantity" min="0"
												th:value="${sessionResource.getQuantity()}" th:disabled="${viewing}"/>
										</div>
										<div class="col-sm-2" align="center">
											<input class="form-check-input" type="checkbox"
												name="perAttendee" th:id="${'perAttendee'+(iter.index+1)}"
												th:checked="${sessionResource.isPerAttendee()}" th:disabled="${viewing}"/> <input
												type="hidden" name="hiddenPerAttendee" id="hiddenPerAttendee" th:disabled="${viewing}"/>
										</div>
										<div th:unless="${viewing}" class="col-sm-3"
											th:id="${'item' + (iter.index+1) + 'buttons'}"
											th:style="${iter.last}?'':'display:none'">
											<button type="button" th:unless="${iter.index==10}"
												th:id="${'add' +(iter.index+1)}" class="btn btn-secondary"
												onClick="addRow(this)">+</button>
											<button type="button" th:unless="${iter.first}"
												th:id="${'remove' +(iter.index+1)}" class="btn btn-secondary"
												onCLick="removeRow(this)">-</button>
										</div>
									</div>
	
									<div th:unless="${viewing}"
										th:each="i : ${#numbers.sequence(clubSession.getEquipmentEventResources().size()+1, 10)}"
										class="row mb-2" th:id="${'item'+i}"
										th:style="${i==1} ? '':'display:none'">
										<div class="col-sm-1" align="right">
											<label  th:text="${'Item '+i+ ':'}">Item 1:</label>
										</div>
										<div class="col-sm-3">
											<select class="form-select form-control-sm mr-sm-2"
												name="equipment" th:id="${'equipment'+i}">
												<option value="0">None</option>
												<option th:each="item : ${equipment}"
													th:value="${item.getResourceId()}"
													th:text="${item.getName()}">Equipment Name</option>
											</select>
										</div>
	
										<div class="col-sm-2">
											<input class="form-control form-control-sm mr-sm-2"
												th:id="${'equipmentQuantity'+ i}" type="number"
												name="equipmentQuantity" min="0" value="0" />
										</div>
										<div class="col-sm-2" align="center">
											<input class="form-check-input" type="checkbox"
												name="perAttendee" th:id="${'perAttendee'+i}" /> <input
												type="hidden" name="hiddenPerAttendee" id="hiddenPerAttendee" />
										</div>
										<div class="col-sm-3" th:id="${'item' + i + 'buttons'}">
											<button type="button" th:unless="${i==10}"
												th:id="${'add' + i}" class="btn btn-secondary"
												onClick="addRow(this)">+</button>
											<button type="button" th:unless="${i==1}"
												th:id="${'remove' + i}" class="btn btn-secondary"
												onCLick="removeRow(this)">-</button>
										</div>
									</div>
								</div>
							</fieldset>
						</div>							
					</div>
				
				
				
				
				
				
				
				
				
				
				<div th:if="${viewing} AND ${clubSession.getAttendees().size>0}"  class="row mb-2">
					<div class="col-sm-1" align="right">
						<label th:if="${takingRegister}">Register:</label>
						<label th:unless="${takingRegister}"    th:text="${clubSession.inPast()} ? 'Attendance:' : 'Bookings:'">Bookings:</label>
					</div>

					<div class="col-sm-10">
						<fieldset class="form-group border p-3">
							<div class="container-fluid no-margin">
							
														
								<div th:unless="${takingRegister}" class="row mb-2">
									<div class="col-sm-12">				
										<div class="row">									
											<div class="col-sm-1 fw-bold">Key:</div>													
											<div class="col-sm-11">
												<fieldset>											
													<div class="container-fluid no-margin">
														<div class="row">				
															<div class="col-sm-4">															
												    			<input type="checkbox" disabled class="Attending Key form-check-input" name="key"/>
												    			<span>Attending</span>										    	
													 		</div>		
															<div class="col-sm-4">																		
												    			<input type="checkbox" disabled class="Missed Key form-check-input" name="key"/>
												    			<span>Missed</span>										    	
													 		</div>
															<div class="col-sm-4">																		
												    			<input type="checkbox" disabled class="Attended Key form-check-input" name="key"/>
												    			<span>Attended</span>										    	
													 		</div>
												 		</div>
											 		</div>											 		
												</fieldset>
											</div>
										</div>											
									</div>
								</div>
							
							
								<div class="row mb-2">
									<div th:if="${takingRegister}" class="col-sm-2 fw-bold" align="left">Attendance</div>
								
									<div class="col-sm-2 fw-bold" align="left">Student Name</div>
									
									<div th:if="${clubSession.includesMenuGroup(menu.getMenuGroupId())}" th:each="menu : ${menus}" class="col-sm-2 fw-bold" align="left" th:text="${menu.getName()}" ></div>											
								</div>
								
								<div th:each="attendee: ${clubSession.getSortedAttendees()}" class="row mb-2" >
																	
									<div th:if="${takingRegister}" class="col-sm-2" align="left">	
										<th:block th:switch="${true}">																	
											<button th:case="${attendee.wasAbsent()}" type=button class="Absent RegisterAbsentButton" th:id="${'AbsentButton_' + attendee.getAttendeeId()}" onClick="updateRegisterButtons(this)">Absent</button>
											<button th:case="${attendee.didAttend()}" type=button class="Present RegisterAbsentButton" th:id="${'AbsentButton_' + attendee.getAttendeeId()}" onClick="updateRegisterButtons(this)">Absent</button>
											<button th:case="*" type=button class="RegisterAbsentButton" th:id="${'AbsentButton_' + attendee.getAttendeeId()}" onClick="updateRegisterButtons(this)">Absent</button>											
										</th:block>
										<th:block th:switch="${true}">																	
											<button th:case="${attendee.wasAbsent()}" type=button class="Absent RegisterPresentButton" th:id="${'PresentButton_' + attendee.getAttendeeId()}" onClick="updateRegisterButtons(this)">Present</button>
											<button th:case="${attendee.didAttend()}" type=button class="Present RegisterPresentButton" th:id="${'PresentButton_' + attendee.getAttendeeId()}" onClick="updateRegisterButtons(this)">Present</button>
											<button th:case="*" type=button class="RegisterPresentButton" th:id="${'PresentButton_' + attendee.getAttendeeId()}" onClick="updateRegisterButtons(this)">Present</button>											
										</th:block>
										<th:block th:switch="${true}">
											<input th:case="${attendee.wasAbsent()}" th:name="'attendee_' + ${attendee.getAttendeeId()}" th:id="'attendee_' + ${attendee.getAttendeeId()}" value="Absent" type="hidden" />										
											<input th:case="${attendee.didAttend()}" th:name="'attendee_' + ${attendee.getAttendeeId()}" th:id="'attendee_' + ${attendee.getAttendeeId()}" value="Present" type="hidden" />
											<input th:case="*" th:name="'attendee_' + ${attendee.getAttendeeId()}" th:id="'attendee_' + ${attendee.getAttendeeId()}" value="NotRecorded'" type="hidden" />
										</th:block>																	
										
										 											
									</div>
																																													
									<div class="col-sm-2" align="left">
										<span th:unless="${takingRegister}" th:switch="${true}" class="col-sm-2">																		
											<input th:case="${clubSession.inPast()} and ${clubSession.endInPast()}" type="checkbox" disabled  th:checked="${attendee.didAttend()}" th:name="'attendee_' + ${attendee.getAttendeeId()}" th:id="'attendee_' + ${attendee.getAttendeeId()}"
										    	th:class="${attendee.didAttend()} ? 'Attended form-check-input' : 'Missed form-check-input'"/>
	
											<input th:case="${clubSession.inPast()} and ${not clubSession.endInPast()}" disabled  type="checkbox" th:checked="${attendee.didAttend()}" th:name="'attendee_' + ${attendee.getAttendeeId()}" th:id="'attendee_' + ${attendee.getAttendeeId()}"
										    	th:class="${attendee.didAttend()} ? 'Attended form-check-input' : 'Attending form-check-input'"/>
										    										
											<input th:case ="*" type="checkbox" th:checked="${attendee.didAttend()}" disabled th:name="'attendee_' + ${attendee.getAttendeeId()}" th:id="'attendee_' + ${attendee.getAttendeeId()}"
										    	th:class="${attendee.didAttend()} ? 'Attended form-check-input' : 'Attending form-check-input'"/>
										</span>
									
										<span th:text="${attendee.getStudent().getFullName()}">Name</span> 
									</div>
																											
									<div th:if="${clubSession.includesMenuGroup(menu.getMenuGroupId())}" th:each="menu : ${menus}" class="col-sm-2">
										<div th:text="${displayHelper.getOptionText(menu, attendee.getStudent(), clubSession)}" class="col-sm-2" align="left" >Menu Option Text</div>
									</div>
																		
								</div>

							</div>
						</fieldset>
					</div>			

				</div>
				<div th:if="${viewing} AND ${clubSession.getAttendees().size==0}"  class="row mb-2">
					<div class="col-sm-1" align="right">
						<label th:text="${clubSession.inPast()} ? 'Attended:' : 'Bookings:'">Bookings:</label>
					</div>
					<div class="col-sm-1" align="left">
						<label>None</label>
					</div>							
				</div>				
				
				<div th:if="${viewing} and ${not takingRegister}" class="row mb-2 p-3">
					<div class="col-sm-12" align="center">
						<a href="./calendar" class="btn btn-secondary" role="button">Back</a>
					</div>
				</div>
				
								
				<div th:unless="${viewing} and ${not takingRegister}" class="row mb-2 p-3">
				
					 <div th:switch="${true}" class="col-sm-6" align="right">
				
					
						<button th:case="${editing}" class="btn btn-primary" name="submit"
							onclick="copyPerAttendee();">Update</button>
						<button th:case="${scheduling}" class="btn btn-primary"
							name="submit"
							onclick="copyPerAttendee()">Schedule</button>
						<button th:case="${takingRegister}" class="btn btn-primary"
							name="submit">Record Register</button>							
					</div>
					<div class="col-sm-6" align="left">
						<a href="./calendar" class="btn btn-secondary" role="button">Cancel</a>
					</div>
				</div>						
				<div class="spacer">&nbsp;</div>
				
			</form>
			
		</div>

	</div>
</body>
</html>